<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link href="/css/main.css" rel="stylesheet">
</head>
<body id="wrap">

<div th:replace="~{ nav.html :: navbar}"></div>

<div id="item-detail-block" class="d-flex justify-content-center my-5">
    <div id="item-detail-image-card">
        <img class="item-detail-image" src="https://placehold.co/300">
    </div>
    <div id="item-detail-card" class="bg-white">
        <div id="item-info-box">
            <h4 th:text="${item.itemName}">상품명</h4>
            <p>⭐⭐⭐⭐⭐</p>
            <p th:text="${item.price + '원'}" class="ms-1" id="itemPrice">상품 가격</p>
        </div>
        <hr>
        <div id="announce-box">
            <p>적립금 :  [[${item.price * 0.03}]] 원(3%) </p>
            <p>배송방법 택배</p>
            <p>배송비 2,500원 (30,000원 이상 무료)</p>
        </div>
        <hr>
        <div id="selection-card" class="mb-2">
            <div class="dropdown">
                <button class="btn dropdown-toggle border" type="button" id="colorSelectBtn" data-bs-toggle="dropdown" aria-expanded="false">
                    컬러
                </button>
                <ul class="dropdown-menu" aria-labelledby="dropdownMenu2">
                    <li><button class="dropdown-item" type="button">블랙</button></li>
                    <li><button class="dropdown-item" type="button">화이트</button></li>
                </ul>
            </div>
            <div class="dropdown mt-2">
                <button class="btn dropdown-toggle border" type="button" id="sizeSelectBtn" data-bs-toggle="dropdown" aria-expanded="false">
                    사이즈
                </button>
                <ul class="dropdown-menu" aria-labelledby="dropdownMenu2">
                    <li><button class="dropdown-item" type="button">S</button></li>
                    <li><button class="dropdown-item" type="button">M</button></li>
                    <li><button class="dropdown-item" type="button">L</button></li>
                </ul>
            </div>
        </div>
        <div>
            <div id="order-info" class=" mt-3">
                <p>블랙 · M</p>
                <div class="d-flex justify-content-between my-3">
                    <div class="input-group my-3" id="itemCountBox">
                        <button type="button" id="subItemCountBtn" class="btn btn-outline-secondary count-btn">-</button>
                        <input type="text" id="itemCount" class="form-control text-center count-input" maxlength="2" value="1">
                        <button type="button" id="addItemCountBtn" class="btn btn-outline-secondary count-btn">+</button>
                    </div>
                    <div id="totalPriceBox" class="mt-2">
                        <p id="itemTotalPrice">[[${item.price}]]원</p>
                    </div>
                </div>
            </div>
        </div>
        <hr>
        <div id="total-fee-announcement-card">
            <div class="d-flex justify-content-between d-none">
                <p class="mb-3" id="orderTotalCount">5개</p>
                <p id="orderTotalPrice"></p>
            </div>
            <div class="d-flex justify-content-end mt-4">
                <button type="button" id="addCartBtn" class="btn btn-lg me-4">장바구니</button>
                <button type="button" class="btn btn-success btn-lg" id="orderBtn">바로구매</button>
            </div>
        </div>
    </div>
</div>

<p>리뷰 작성</p>
<form action="/comment" method="POST">
    <input name="content">
    <input name="parentId" th:value="${item.id}" style="display : none">
    <button type="submit">작성</button>
</form>
<br>

<div class="bg-warning">
    <button>상세정보</button>
    <button>리뷰</button>
    <button>상품문의</button>
    <button>추천상품</button>
</div>
<div class="bg-success">
    상세정보 블럭
</div>
<div class="bg-danger">
    리뷰 블럭
    <div class="commentList">
        <div th:each="comment : ${commentList}">
            <div>
                <p th:text="${comment.content + ' - ' + comment.username}"></p>
            </div>
        </div>
    </div>


</div>
<div class="bg-info">
    상품문의 블럭
</div>
<div class="bg-warning">
    추천상품 블럭
</div>

<div th:replace="~{ footer.html :: footer}"></div>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>


<script>
    // 색상과 사이즈를 선택하면 버튼 변경하여 현재 선택 정보 보여주기
    document.querySelectorAll('.dropdown-item').forEach(item => {
        item.addEventListener('click', function (event) {
            event.preventDefault();

            const selectedText = this.textContent;
            const dropdown = this.closest('.dropdown');
            const button = dropdown.querySelector('.dropdown-toggle');

            button.textContent = selectedText;
        });
    });

    // 제품 수량에 변화가 있을 때 총 금액 변화시키기
    function updateItemTotalPrice() {
        let itemCount = $("#itemCount").val();
        let itemPrice = document.getElementById("itemPrice");
        let intItemPrice = parseInt(itemPrice.textContent.replace(/[,원]/g, ""));
        let total = itemCount * intItemPrice;
        itemTotalPrice.textContent = total.toLocaleString() + "원";
    }

    $(document).ready(function(){
        $("#itemCount").on("change", function(){

            let cnt = $("#itemCount").val();

            if(cnt > 1){
                cnt = $("#itemCount").val();
                $("#itemCount").val(cnt);
                updateItemTotalPrice();
            } else {
                alert("0 이하의 숫자는 입력할 수 없습니다.");
                $("#itemCount").val(1);
                updateItemTotalPrice();
            }
            updateItemTotalPrice();
        });

        $("#orderBtn").on("click",function(){
            let itemCount = $("#itemCount").val();
            alert(itemCount);
        });

        $("#subItemCountBtn").on("click", function(){
            if(cnt > 1){
                cnt = $("#itemCount").val();
                cnt--;
                $("#itemCount").val(cnt);
                updateItemTotalPrice();
            } else {
                alert("0 이하의 숫자는 입력할 수 없습니다.");
                $("#itemCount").val(1);
                updateItemTotalPrice();
            }
        });

        $("#addItemCountBtn").on("click",function(){
            cnt = $("#itemCount").val();
            cnt++;
            $("#itemCount").val(cnt);
            updateItemTotalPrice();
        });

        let itemTotalPrice = document.getElementById("itemTotalPrice");
        let orderTotalPrice = document.getElementById("orderTotalPrice");
    });

</script>

</body>
</html>